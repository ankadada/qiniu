本插件目前的功能: 

1. 上传/删除 图片
2. 上传/删除 附件
3. 上传/更新 分类信息图片
4. 删除主题时, 同时删除上传文件
5. 原图保护, 支持水印
6. 缩略图生成
7. 下载 图片/附件
8. 远程图片下载

# 更新

1. 点评/评分 后图片地址问题
2. 远程图片下载 文件名使用原文件名
3. 修复图片大小显示为0的bug

# 文件

存入数据库的文件名是七牛的sha1文件校验算法所生成的名字. 可以有效避免重复文件.

(七牛那边的1个文件, 可以在论坛这边被N个帖子所使用)

也方便以后开发秒传等功能. 使用原生JS, 不依赖flash上传, 同时旧版本的IE浏览器也不支持.

# 部署

PHP版本要求 >= 5.4
使用本插件后会替代discuz的上传服务, 所以你的网站有很多原先使用discuz的上传的附件, 不建议使用!

使用本插件存入数据库的附件地址是这种形式的: data/attachment/forum/FkRsIOKizjRdSb9lqUs9ri7AbDjv.png
所以需要使用重写来重定向到七牛的URL.

Apache: 
在 data/attachment/forum/ 目录下创建 .htaccess 文件, 内容如下: 
```
RewriteEngine On
RewriteBase /
RewriteRule ^(.*)$ http://七牛URL/$1
```

Nginx: 
```
rewrite data/attachment/forum/^(.*)$ http://七牛URL/$1 break;
```

IIS: 
```
<rule name="301Redirect" stopProcessing="true">
    <match url="data/attachment/forum/(.*)" />
    <action type="Redirect" url="http://七牛URL/{R:1}" redirectType="Permanent" />
</rule>
```

# 配置

`AK` `SK` 是你在七牛那边获得的, `空间名` 是你所创建的空间的名称.

`七牛URL` 填写你创建的空间的URL地址, 或你所绑定的域名. 必须以"http://"开头, 以"/"结尾!
`原图保护` 根据你的空间的设置而去选择.

`默认样式` `缩略图样式` 填写你在七牛创建的图片样式的名称.
(若未开启`原图保护`, 则为可选, 开启后则必须设置!)

可以在 `默认样式` 填写你的水印样式, 以达到图片加水印的目的.
`缩略图样式` 则填写你所设置的缩略图样式, 建议缩略图大小`300x300`, 缩略方式为`指定宽高缩放 `

**注意: `原图保护` `默认样式` `缩略图样式` 在你第一次使用插件的时候设置, 以后将不能再次修改! 所以你要想清楚再去设置!!! **

# 数据库
为了不改变discuz数据库结构, 使用XML做小型数据库. 所以需要你的服务器支持并启用了XML相关组件.
